# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1x_HBsp9o9RPOh-b7f_2Tb93y-M6i7c-w
"""

import streamlit as st
from utils import load_models, load_feature_lists, load_model_performances, prepare_input_data, make_predictions
import pandas as pd

# Sayfa yap覺land覺rmas覺
st.set_page_config(
    page_title="N繹rogeliimsel Bozukluk Tahmin Sistemi",
    page_icon="",
    layout="wide"
)

# CSS stilleri
st.markdown("""
<style>
    .risk-box {
        padding: 20px;
        border-radius: 10px;
        margin: 10px 0;
        text-align: center;
    }
    .high-risk {
        background-color: rgba(255, 0, 0, 0.1);
        border: 2px solid red;
    }
    .medium-risk {
        background-color: rgba(255, 165, 0, 0.1);
        border: 2px solid orange;
    }
    .low-risk {
        background-color: rgba(0, 255, 0, 0.1);
        border: 2px solid green;
    }
</style>
""", unsafe_allow_html=True)

def main():
    st.title("N繹rogeliimsel Bozukluk Tahmin Sistemi")
    
    try:
        # Modelleri, 繹zellikleri ve performans metriklerini y羹kle
        models = load_models()
        feature_lists = load_feature_lists()
        model_performances = load_model_performances()
        
        # Form olutur
        with st.form("prediction_form"):
            st.subheader("L羹tfen aa覺daki sorular覺 cevaplay覺n覺z:")
            
            # Her kategori i癟in ayr覺 bal覺k ve sorular
            answers = {}
            for category, features in feature_lists.items():
                if category != "all_features":  # all_features kategorisini atla
                    st.write(f"### {category} ile ilgili sorular")
                    for feature in features:
                        answers[feature] = st.radio(
                            feature,
                            options=["Evet", "Hay覺r"],
                            key=feature
                        )
            
            submit_button = st.form_submit_button("Tahmin Yap")
        
        if submit_button:
            # Kullan覺c覺 cevaplar覺n覺 haz覺rla
            input_data = prepare_input_data(answers)
            
            # Tahminleri yap
            predictions = make_predictions(models, input_data, model_performances)
            
            st.subheader("Tahmin Sonu癟lar覺:")
            
            # Sonu癟lar覺 risk seviyelerine g繹re s覺n覺fland覺r ve g繹ster
            for condition, prob in predictions.items():
                prob_percentage = prob * 100
                if prob_percentage >= 70:
                    risk_class = "high-risk"
                    risk_level = "Y羹ksek"
                elif prob_percentage >= 40:
                    risk_class = "medium-risk"
                    risk_level = "Orta"
                else:
                    risk_class = "low-risk"
                    risk_level = "D羹羹k"
                
                st.markdown(
                    f"""
                    <div class="risk-box {risk_class}">
                        <h4>{condition}</h4>
                        <p>Risk Seviyesi: {risk_level}</p>
                        <p>Risk Oran覺: {prob_percentage:.1f}%</p>
                    </div>
                    """,
                    unsafe_allow_html=True
                )
    
    except Exception as e:
        st.error(f"Bir hata olutu: {str(e)}")
        st.error("L羹tfen t羹m gerekli dosyalar覺n mevcut olduundan emin olun (models.zip, selected_features.xlsx, model_performance.xlsx)")

if __name__ == "__main__":
    main()